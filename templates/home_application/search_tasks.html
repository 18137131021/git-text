<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title></title>
    <!-- 若您需要使用Kendo UI Professional，请联系版权人获得合法的授权或许可。 -->
    <!-- Bootstrap css -->
    <link href="https://magicbox.bk.tencent.com/static_api/v3/assets/bootstrap-3.3.4/css/bootstrap.min.css"
          rel="stylesheet">
    <!-- kendo ui css -->
    <link href="https://magicbox.bk.tencent.com/static_api/v3/assets/kendoui-2015.2.624/styles/kendo.common.min.css"
          rel="stylesheet">
    <link href="https://magicbox.bk.tencent.com/static_api/v3/assets/kendoui-2015.2.624/styles/kendo.default.min.css"
          rel="stylesheet">
    <!-- font-awesome -->
    <link href="https://magicbox.bk.tencent.com/static_api/v3/assets/fontawesome/css/font-awesome.css" rel="stylesheet">
    <!--蓝鲸提供的公用样式库 -->
    <link href="https://magicbox.bk.tencent.com/static_api/v3/bk/css/bk.css" rel="stylesheet">
    <link href="https://magicbox.bk.tencent.com/static_api/v3/bk/css/bk_pack.css" rel="stylesheet">
    <link href="http://cdn.datatables.net/1.10.15/css/jquery.dataTables.min.css">
    <link href="https://magicbox.bk.tencent.com/static_api/v3/assets/daterangepicker-2.0.5/daterangepicker.css"
          rel="stylesheet">
    <link href="https://magicbox.bk.tencent.com/static_api/v3/assets/artDialog-6.0.4/css/ui-dialog.css"
          rel="stylesheet">

    <!-- 如果要使用Bootstrap的js插件，必须先调入jQuery -->
    <script src="https://magicbox.bk.tencent.com/static_api/v3/assets/js/jquery-1.10.2.min.js"></script>
    <!-- 包括所有bootstrap的js插件或者可以根据需要使用的js插件调用　-->
    <script src="https://magicbox.bk.tencent.com/static_api/v3/assets/echarts-2.0/echarts-all.js"></script>
    <script src="https://magicbox.bk.tencent.com/static_api/v3/assets/bootstrap-3.3.4/js/bootstrap.min.js"></script>
    <!-- 包括所有kendoui的js插件或者可以根据需要使用的js插件调用　-->
    <script src="https://magicbox.bk.tencent.com/static_api/v3/assets/kendoui-2015.2.624/js/kendo.all.min.js"></script>
    <script src="https://magicbox.bk.tencent.com/static_api/v3/assets/echarts-2.0/echarts-all.js"></script>
    <script src="https://magicbox.bk.tencent.com/static_api/v3/bk/js/bk.js"></script>
    <!-- 数据埋点统计 -->
    <script src="http://magicbox.bk.tencent.com/static_api/analysis.js"></script>
    <script src="http://cdn.datatables.net/1.10.15/js/jquery.dataTables.min.js"></script>
    <script src="https://magicbox.bk.tencent.com/static_api/v3/assets/daterangepicker-2.0.5/moment.min.js"></script>
    <script src="https://magicbox.bk.tencent.com/static_api/v3/assets/daterangepicker-2.0.5/daterangepicker.js"></script>
    <script src="https://magicbox.bk.tencent.com/static_api/v3/assets/artDialog-6.0.4/dist/dialog-min.js"></script>
    <!-- 以下两个插件用于在IE8以及以下版本浏览器支持HTML5元素和媒体查询，如果不需要用可以移除 -->
    <!--[if lt IE 9]><script src="https://magicbox.bk.tencent.com/static_api/v3/assets/js/html5shiv.min.js"></script><script src="https://magicbox.bk.tencent.com/static_api/v3/assets/js/respond.min.js"></script>
    <![endif]-->

</head>
<style type="text/css">
    html, body {
        padding: 0px;
        margin: 0px;
    }

    table {
        margin: 0px;
        padding: 0px;
        width: 30%;
        border-collapse: collapse;
        table-layout: fixed; /*不添加此样式，会全部显示    */
    }

    table td {
        border: 1px solid #eef2e9;
        /* text-overflow: ellipsis; */ /* 加上，显示省略号*/
        white-space: nowrap;
        overflow: hidden;
    }

    table td:hover { /* 鼠标滑过  显示隐藏的内容  伴有横向的滚动条 */
        overflow: auto;
        text-overflow: clip;
    }

    .ui-popup {
        width: 470px !important;
    }
</style>
<body class="bg-white" data-bg-color="bg-white">
<div class="king-page-box">
    <div class="king-layout1-header">
        <nav class="">
            <div style="overflow:hidden; z-index: inherit;" class="navbar king-horizontal-nav1  f14">
                <div class="navbar-container">
                    <div class="navbar-header pull-left">
                        <a class="navbar-brand" href="javascript:;">
                            <img src="https://magicbox.bk.tencent.com/static_api/v3/bk/images/logo.png" class="logo">
                        </a>
                    </div>
                    <ul class="nav navbar-nav pull-left m0">
                        <li class="active"><a href="javascript:void(0);">首页</a></li>
                    </ul>
                    <div class="navbar-header pull-right">
                        <ul class="nav">
                            <li class="user-info">
                                <a href="javascript:;">
                                    <img class="img-rounded"
                                         src="https://magicbox.bk.tencent.com/static_api/v3/components/horizontal_nav1/images/avatar.png">
                                    <span>${request.user.username}</span>
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </nav>
    </div>
    <div class="king-layout1-main clearfix">
        <!-- sidebar start -->
        <div class="king-layout1-sidebar" style="width:216px;">
            <nav style="height:100%;" class="   f14">
                <div class="king-vertical-nav4">
                    <div class="sidebar-inner">
                        <ul class="navi">
                            <li class="has_submenu current open c-open active">
                                <a href="javascript:void(0);"> <i class="fa fa-gear "> </i>
                                    <span>任务</span>
                                    <span class="pull-right"><i class="fa fa-angle-down"></i></span>
                                </a>
                                <ul class="sub-menu">

                                    <li><a href="${SITE_URL}search_tasks/">任务中心<i
                                            class="fa fa-chevron-right pull-right"></i></a></li>

                                    <li><a href="${SITE_URL}">任务模板<i
                                            class="fa fa-chevron-right pull-right"></i></a></li>
                                </ul>
                            </li>
                        </ul>
                    </div>
                </div>
            </nav>
        </div>
        <div class="king-content-wrap">
            <div class="king-layout1-content" style="margin-left: 216px;">
                <div class="king-block king-block-bordered king-block-themed mb0">
                    <div class="king-block-header king-info">
                        <ul class="king-block-options">
                            <li>
                                <!-- <button type="button"><i class="fa fa-cog"></i></button> -->
                            </li>
                        </ul>
                        <h3 class="king-block-title">任务模板</h3>
                    </div>
                    <div class="form-group clearfix ">
                        <label class="col-sm-3 control-label bk-lh30 pt0">业务：</label>
                        <div class="col-sm-7">
                            <select name="select_business1" id="select_business1"
                                    class="form-control bk-valign-top">
                                <option value="">选择业务</option>
                                %for data in all_pid:
                                <option value=${data}>${all_pid[data]}</option>
                                %endfor
                            </select>
                        </div>
                    </div>
                    <div class="form-group clearfix ">
                        <label class="col-sm-3 control-label bk-lh30 pt0">选择集群：</label>
                        <div class="col-sm-7">
                            <select name="select_business4" id="select_business4"
                                    class="form-control bk-valign-top">
                                <option value="">请选择集群</option>

                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-3 control-label">选择主机:</label>
                        <div class="col-sm-7">
                            <span class="" style="cursor:pointer;" data-toggle="modal" data-target="#role">
                                <a class="king-btn-demo king-btn king-default" title="提交">选择主机</a>
                            </span>
                        </div>
                    </div>
                    <div class="form-group clearfix ">
                        <label class="col-sm-3 control-label bk-lh30 pt0">模板类型：</label>
                        <div class="col-sm-7">
                            <select name="module_type" id="module_type"
                                    class="form-control bk-valign-top">
                                <option value="变更发布">变更发布</option>
                                <option value="扩缩容">扩缩容</option>
                                <option value="上线类">上线类</option>
                                <option value="下架类">下架类</option>
                                <option value="例行维护">例行维护</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group clearfix ">
                        <label class="col-sm-3 control-label bk-lh30 pt0">模板名称：</label>
                        <div class="col-sm-7">
                            <input name="module_params" type="text" class="form-control" id="inputCount3"
                                   placeholder="名称">
                        </div>
                    </div>
                    <div class="form-group clearfix ">
                        <label class="col-sm-3 control-label bk-lh30 pt0">选择时间：</label>
                        <div class="col-sm-2">
                            开始--- <input type="text" class="form-control daterangepicker_demo"
                                         id="daterangepicker_demo1" placeholder="选择日期...">

                        </div>
                        <div class="col-sm-2">
                            结束--- <input type="text" class="form-control daterangepicker_demo"
                                         id="daterangepicker_demo2" placeholder="选择日期...">
                        </div>
                    </div>
                    <div class="form-group clearfix">
                        <div class="col-sm-9 col-sm-offset-3">
                            <input id="search_job_task" type="button" value="查询"
                                   class="king-btn mr10  king-success">
                        </div>
                    </div>
                    <div class="form-group clearfix">
                        <div class="col-sm-9 col-sm-offset-3">
                            <a href="${SITE_URL}add_module/">新增模板<i
                                    class="fa fa-chevron-right pull-right"></i></a>
                        </div>
                    </div>
                </div>
                <div id="change_table" class="pagination">
                    <table id="table_data" class="table table-striped">
                        <thead>
                        <tr>
                            <th style="width:20%;">模板名称</th>
                            <th>业务名称</th>
                            <th>模板类型</th>

                            <th>创建者</th>
                            <th>创建时间</th>
                            <th>更新者</th>
                            <th>更新时间</th>
                            <th>操作</th>

                        </tr>
                        </thead>
                        <tbody id="table_body">
                        %if contacts == '':
                        <tr>
                            <td>暂时为空</td>
                        </tr>
                        %else:
                        %for one_task in contacts:
                        <tr id="search_task_data" class="search_task_data">
                            <td>${ one_task.module_name }</td>
                            <td>${ one_task.biz_name }</td>
                            <td>${ one_task.module_type }</td>
                            <td>${ one_task.hands_user }</td>
                            <td>${ one_task.module_time }</td>
                            <td>${ one_task.updata_hands_user }</td>
                            <td>${ one_task.updata_module_time }</td>

                            <td>
                                <a href="${SITE_URL}add_task/${ one_task.id }">创建任务</a>
                                <a href="${SITE_URL}download_module/${ one_task.id }">下载模板</a>
                                <a href="${SITE_URL}del_module/${ one_task.id }">删除模板</a>

                            </td>

                        </tr>
                        %endfor
                        %endif
                        </tbody>
                    </table>
                    <div class="pagination" style="float:right">
                        <ul class="step-links">
                            %if contacts.has_previous():
                            <li><a href="?page=${contacts.previous_page_number()}">上一页</a>
                                %endif

                                <span class="current">
                            ${ contacts.number }/${contacts.paginator.num_pages}
                            </span>

                                %if contacts.has_next():
                                <a href="?page=${contacts.next_page_number()}">下一页</a></li>
                            %endif
                        </ul>
                    </div>
                    <div class="modal fade" id="role" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
                         aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                                        &times;
                                    </button>
                                    <h4 class="modal-title" id="myModalLa">主机列表</h4>
                                    <input id="btn4" type="checkbox"><label>全选</label>
                                </div>
                                <div class="modal-body data_list" id="data_list">

                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-primary" id="btn3" data-dismiss="modal"
                                            aria-hidden="true">确定
                                    </button>
                                </div>
                            </div><!-- /.modal-content -->
                        </div><!-- /.modal -->

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<--*

<script>

    $(function () {

        var li = $('.navi li');
        li.each(function () {
            $(this).click(function () {
                if ($(this).hasClass('c-open')) {
                    $(this).find('ul').slideUp(350);
                    $(this).removeClass('c-open');
                } else {
                    $(this).find('ul').slideDown(350);
                    $(this).addClass('c-open');
                }
            })
        });
        // 通过点击业务获取集群下拉列表操作
        $('#select_business1').change(function () {
            console.log('获取');
            var calve_data1 = $('#select_business1').val();
            var calve_data = calve_data1.split(',')[0];
            console.log('calve_data', calve_data);
            var url_data2 = '${SITE_URL}' + 'search_colony/';
            console.log(url_data2);
            $.ajax({
                url: url_data2,
                type: 'get',
                dataType: 'json',
                data: {
                    biz_id: calve_data
                },
                success: function (data2) {
                    console.log('获取');
                    $("#select_business4 option").remove();
                    console.log(data2.data);
                    for (var i = 0; i < data2.data.list.length; i++) {
                        $('#select_business4').append("<option value='" + data2.data.list[i].set_id + "'>" + data2.data.list[i].set_name + "</option>")
                    }


                }
            });
        });

        // 查询主机加载到模态框
        $('#select_business4').change(function () {
            var calve_data4 = $('#select_business1').val();
            var calve_data5 = $('#select_business4').val();
            var url_data = '${SITE_URL}' + 'search_pc/';
            $.ajax({
                url: url_data,
                type: 'get',
                dataType: 'json',
                data: {
                    biz_id: calve_data4,
                    set_id: calve_data5
                },
                success: function (data) {
                    console.log('获取');
                    $("#data_list").empty();
                    for (var i = 0; i < data.data.list.length; i++) {
                        $('.data_list').append('<p><input type="checkbox" name="jiaoben_role" class="check_role" value="' + data.data.list[i].ip + '|' + data.data.list[i].area_id + '"><label for="">' + data.data.list[i].area + '|' + data.data.list[i].ip + '|' + data.data.list[i].os_name + '</label></p>')
                    }


                }
            });
        });

        // 主机选择的模态框中全选的操作
        $("#btn4").click(function () {
            var xz = $(this).prop("checked");
            var ck = $(".check_role").prop("checked", xz);
        });

        // 通过点击查询按钮获取条件查询并返回数据（一个load页面）
        $('#search_job_task').click(function () {
            var data1 = $('#select_business2').val();
            var data2 = $('#module_type').val();
            var data3 = $('#inputCount3').val();
            var d = dialog({
                width: 440,
                title: "提示",
                content: '<div class="king-notice3 king-notice-success">' +
                '<span class="king-notice-img"></span>' +
                '<div class="king-notice-text">' +
                '<p class="f24">正在查询</p>' +
                '<p class="f12">' +
                '</p>' +
                '</div>' +
                '</div>',
            });
            d.show();
            $.ajax({
                url: '${SITE_URL}' + 'search_all_job/',
                type: 'get',
                dataType: 'html',
                data: {
                    biz_name: data1,
                    module_type: data2,
                    inputCount3: data3,
                },

                success: function (data) {
                    d.close();
                    $("#change_table").html(data);

                }

            });
        });
    });

    $('#daterangepicker_demo1').daterangepicker({
        locale: {
            format: 'YYYY-MM-DD HH:mm:ss'
        },
        autoApply: true,//选择日期后自动设置值
        singleDatePicker: true,//单选选择一个日期
        timePicker: true,//支持时间选择
        timePicker24Hour: true,//开启24小时时间制
        timePickerIncrement: 5, //分钟间隔
        timePickerSeconds: true //开启分钟选择

    });
    $('#daterangepicker_demo2').daterangepicker({
        locale: {
            format: 'YYYY-MM-DD HH:mm:ss'
        },
        autoApply: true,//选择日期后自动设置值
        singleDatePicker: true,//单选选择一个日期
        timePicker: true,//支持时间选择
        timePicker24Hour: true,//开启24小时时间制
        timePickerIncrement: 5, //分钟间隔
        timePickerSeconds: true //开启分钟选择

    });

</script>